# 워크플로우 이름
name: Slack Push Notification

# 언제 실행할지 결정 (main 브랜치에 push가 될 때)
on:
  push:
    branches: [ "main" ]

# 실행할 작업
jobs:
  send-notification:
    name: Send push notification
    runs-on: ubuntu-latest
    steps:
    # 이 단계 하나만 있으면 됩니다.
    - name: Notify on push
      uses: slackapi/slack-github-action@v1.25.0
      with:
        # 블록(Blocks)을 사용해 멋진 메시지 보내기
        payload: |
          {
            "blocks": [
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": "🚀 *${{ github.repository }}* 레포지토리에 새로운 커밋이 push 되었습니다!"
                }
              },
              {
                "type": "section",
                "fields": [
                  {
                    "type": "mrkdwn",
                    "text": "*Author:*\n${{ github.actor }}"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*Commit Message:*\n${{ github.event.head_commit.message }}"
                  }
                ]
              },
              {
                "type": "actions",
                "elements": [
                  {
                    "type": "button",
                    "text": {
                      "type": "plain_text",
                      "text": "자세히 보기",
                      "emoji": true
                    },
                    "url": "${{ github.event.head_commit.url }}"
                  }
                ]
              }
            ]
          }
      env:
        # GitHub Secrets에 저장된 슬랙 토큰과 채널 ID를 사용합니다.
        SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
        SLACK_CHANNEL_ID: C09CZPMC6VC